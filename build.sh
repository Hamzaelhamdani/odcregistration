#!/bin/bash#!/bin/bash#!/bin/bash

# build.sh - Build script for Netlify

# build.sh - Script de build pour Netlify# build.sh - Build script for Netlify

set -e

# This script injects environment variables into env.js at build time

echo "ğŸ”§ Starting build process..."

set -e

# Check if environment variables are set

if [ -z "$SUPABASE_URL" ] || [ -z "$SUPABASE_ANON_KEY" ]; thenset -e  # Exit on error

    echo "âŒ Error: SUPABASE_URL and SUPABASE_ANON_KEY must be set"

    exit 1echo "ğŸ”§ GÃ©nÃ©ration de env.js..."

fi

echo "ğŸ”§ Starting build process..."

echo "ğŸ“ Generating env.js..."

# VÃ©rifier que les variables sont dÃ©finies

# Create env.js with environment variables

cat > env.js << 'EOF'if [ -z "$SUPABASE_URL" ] || [ -z "$SUPABASE_ANON_KEY" ]; then# Check if environment variables are set

(function() {

    "use strict";    echo "âŒ Erreur: Variables SUPABASE_URL et SUPABASE_ANON_KEY manquantes"if [ -z "$SUPABASE_URL" ] || [ -z "$SUPABASE_ANON_KEY" ]; then

    window.ENV = {

        SUPABASE_URL: 'PLACEHOLDER_URL',    exit 1    echo "âŒ Error: SUPABASE_URL and SUPABASE_ANON_KEY must be set in Netlify environment variables"

        SUPABASE_ANON_KEY: 'PLACEHOLDER_KEY'

    };fi    exit 1

    console.log('ğŸ”§ Configuration loaded:', {

        url: window.ENV.SUPABASE_URL,fi

        hasKey: !!window.ENV.SUPABASE_ANON_KEY

    });# GÃ©nÃ©rer env.js depuis le template

})();

EOFcat > env.js << EOFecho "ğŸ“ Generating env.js with environment variables..."



# Replace placeholders with actual values(function() {

sed -i "s|PLACEHOLDER_URL|$SUPABASE_URL|g" env.js

sed -i "s|PLACEHOLDER_KEY|$SUPABASE_ANON_KEY|g" env.js    "use strict";# Create env.js directly with the environment variables



echo "âœ… env.js generated successfully"    window.ENV = {cat > env.js << EOF

echo "âœ… Build completed"

        SUPABASE_URL: '$SUPABASE_URL',/*

        SUPABASE_ANON_KEY: '$SUPABASE_ANON_KEY' * env.js - Generated by build script

    }; * DO NOT EDIT MANUALLY - This file is auto-generated during deployment

    console.log('ğŸ”§ Configuration Supabase chargÃ©e:', { */

        url: window.ENV.SUPABASE_URL,

        hasKey: !!window.ENV.SUPABASE_ANON_KEY(function() {

    });    "use strict";

})();

EOF    // Variables d'environnement injectÃ©es pendant le build

    window.ENV = {

echo "âœ… env.js gÃ©nÃ©rÃ© avec succÃ¨s"        SUPABASE_URL: '$SUPABASE_URL',

        SUPABASE_ANON_KEY: '$SUPABASE_ANON_KEY'
    };

    // Helpful debug output (doesn't print the key value)
    console.log('ğŸ”§ Variables d\'environnement chargÃ©es:', {
        url: window.ENV.SUPABASE_URL,
        hasKey: !!window.ENV.SUPABASE_ANON_KEY
    });
})();
EOF

echo "âœ… env.js generated successfully"
echo "âœ… Build completed"
